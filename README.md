# Симуляция системы массового обслуживания (СМО) методом Монте-Карло

Этот проект реализует симуляцию системы массового обслуживания (СМО) с неограниченной очередью методом Монте-Карло. Цель проекта — моделирование процесса обслуживания заявок с использованием случайных чисел и расчет статистических показателей эффективности системы.

## Структура проекта

Проект состоит из следующих модулей:

- `data_models.py`: Классы данных для хранения информации об итерациях и результатах симуляции.
- `custom_exceptions.py`: Пользовательские исключения для обработки ошибок ввода.
- `helpers.py`: Вспомогательные функции для округления значений, расчета интервалов и генерации случайных чисел.
- `iteration_processor.py`: Функция для обработки одной итерации симуляции.
- `queue_simulation.py`: Функция для запуска симуляции с использованием параллельного выполнения итераций.
- `main.py`: Пример использования симуляции.

## Установка

1. Склонируйте репозиторий:
    ```bash
    git clone https://github.com/username/repo.git
    cd repo
    ```

2. Установите необходимые зависимости:
    ```bash
    poetry install
    ```

## Использование

### Пример использования

Для запуска симуляции, выполните скрипт `main.py`:

```python
from queue_simulation import simulate_queue

# Пример использования
queue = simulate_queue(
    service_time=0.5, 
    max_time=10, 
    alpha=5,
    num_threads=3,
    num_iterations=1000  # Увеличено для демонстрации
)

# Вывод результата
for answer in queue.results[:5]:  # Ограничиваем вывод первыми 5 ответами
    print(f'Iterations: {len(answer.iterations)}, Expected value: {answer.expected_value}')
print(f'Average value: {queue.average_value}')
```

### Функции и их описание

#### `simulate_queue`

```python
def simulate_queue(service_time: float, max_time: float, alpha: float, num_threads: int = 1, num_iterations: int = 1) -> Queue:
```

Симулирует работу очереди с указанными параметрами методом Монте-Карло.

**Параметры**:
- `service_time` (float): Время обслуживания одной заявки.
- `max_time` (float): Максимальное время симуляции.
- `alpha` (float): Параметр для расчета интервала между заявками.
- `num_threads` (int): Количество потоков (серверов) для обработки заявок. По умолчанию 1.
- `num_iterations` (int): Количество итераций симуляции. По умолчанию 1.

**Возвращает**:
- `Queue`: Объект Queue, содержащий результаты симуляции и среднее количество обработанных заявок.

**Исключения**:
- `NumIterationsNegative`: Если `num_iterations` < 0.
- `NumIterationsIsZero`: Если `num_iterations` == 0.
- `NumThreadsNegative`: Если `num_threads` < 0.
- `NumThreadsIsZero`: Если `num_threads` == 0.
- `AlphaIsZero`: Если `alpha` == 0.
- `AlphaNegative`: Если `alpha` < 0.
- `ServiceTimeNegative`: Если `service_time` < 0.
- `MaxTimeNegative`: Если `max_time` < 0.

#### `process_iteration`

```python
def process_iteration(service_time: float, max_time: float, alpha: float, num_threads: int) -> Answer:
```

Обрабатывает одну итерацию симуляции очереди с заданными параметрами.

**Параметры**:
- `service_time` (float): Время обслуживания одной заявки.
- `max_time` (float): Максимальное время симуляции.
- `alpha` (float): Параметр для расчета интервала между заявками.
- `num_threads` (int): Количество потоков (серверов) для обработки заявок.

**Возвращает**:
- `Answer`: Объект Answer, содержащий результаты итерации и количество обработанных заявок.

## Структура данных

### `Iteration`

Класс для хранения информации об одной итерации симуляции.

**Атрибуты**:
- `index` (int): Индекс итерации.
- `random_value` (float): Случайное значение, использованное для расчета интервала между заявками.
- `interval_between_apps` (float): Расчетный интервал между заявками.
- `application_time` (float): Время поступления заявки.
- `server_times` (list[float]): Время занятости серверов (потоков) на момент поступления заявки.

### `Answer`

Класс для хранения результатов одной итерации симуляции очереди.

**Атрибуты**:
- `iterations` (list[Iteration]): Список объектов Iteration, представляющих каждую обработанную заявку.
- `expected_value` (float): Ожидаемое значение (например, количество обработанных заявок).

### `Queue`

Класс для хранения результатов всех итераций симуляции очереди и среднего значения.

**Атрибуты**:
- `results` (list[Answer]): Список объектов Answer, представляющих результаты каждой итерации.
- `average_value` (float): Среднее значение (например, среднее количество обработанных заявок) по всем итерациям.

## Исключения

### `NumIterationsNegative`

Исключение выбрасывается, если количество итераций отрицательное.

### `NumIterationsIsZero`

Исключение выбрасывается, если количество итераций равно нулю.

### `NumThreadsNegative`

Исключение выбрасывается, если количество потоков отрицательное.

### `NumThreadsIsZero`

Исключение выбрасывается, если количество потоков равно нулю.

### `AlphaIsZero`

Исключение выбрасывается, если параметр alpha равен нулю.

### `AlphaNegative`

Исключение выбрасывается, если параметр alpha отрицательный.

### `ServiceTimeNegative`

Исключение выбрасывается, если время обслуживания отрицательное.

### `MaxTimeNegative`

Исключение выбрасывается, если максимальное время симуляции отрицательное.

## Вспомогательные функции

### `round_value`

```python
def round_value(value, decimals=4):
```

Округляет значение до указанного количества десятичных знаков.

### `interval_between_apps`

```python
def interval_between_apps(alpha, random_value):
```

Вычисляет интервал между заявками на основе параметра alpha и случайного значения.

### `max_row`

```python
def max_row(lst):
```

Возвращает максимальное значение в списке.

### `transpose`

```python
def transpose(matrix):
```

Транспонирует матрицу, заменяя строки на столбцы.

### `max_columns`

```python
def max_columns(lst):
```

Возвращает список максимальных значений для каждого столбца матрицы.

### `generate_random_number`

```python
def generate_random_number():
```

Генерирует случайное число в диапазоне (0, 1] с округлением до 4 знаков после запятой.

### `sum_expected_values`

```python
def sum_expected_values(lst):
```

Вычисляет сумму ожидаемых значений из списка объектов Answer.